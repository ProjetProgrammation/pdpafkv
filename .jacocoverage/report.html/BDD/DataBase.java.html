<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>DataBase.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCoverage analysis of project &quot;ProjectProg&quot; (powered by JaCoCo from EclEmma)</a> &gt; <a href="index.source.html" class="el_package">BDD</a> &gt; <span class="el_source">DataBase.java</span></div><h1>DataBase.java</h1><pre class="source lang-java linenums">/**
 * *********************************************
 *
 *
 * &lt;b&gt;Warning: the nomenclature is not the same in the database and Java.&lt;/b&gt;
 * &lt;p&gt;
 * The right way to name variables :
 * &lt;ul&gt;
 * &lt;li&gt;Database : file_path&lt;/li&gt;
 * &lt;li&gt;Java : filePath&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;/p&gt;
 *
 *
 **********************************************
 */
package BDD;

import java.sql.*;
import java.util.ArrayList;

/**
 * Use this class to create a database and interact with it.
 *
 * @author akervadec
 */
public class DataBase {

<span class="fc" id="L29">    public DataBase() {</span>
<span class="fc" id="L30">        this.connexion();</span>
<span class="fc" id="L31">        this.createTables();</span>
<span class="fc" id="L32">    }</span>

    /**
     * Establishes a connection with the database dataBase.db, or create it if
     * it doesn't exist yet.
     *
     * @return Connection.
     */
    public Connection connexion() {

<span class="fc" id="L42">        Connection c = null;</span>
        try {
<span class="fc" id="L44">            Class.forName(&quot;org.sqlite.JDBC&quot;);</span>
<span class="fc" id="L45">            c = DriverManager.getConnection(&quot;jdbc:sqlite:dataBase.db&quot;);</span>
<span class="nc" id="L46">        } catch (ClassNotFoundException | SQLException e) {</span>
<span class="nc" id="L47">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L48">            System.exit(0);</span>
<span class="fc" id="L49">        }</span>
<span class="fc" id="L50">        System.out.println(&quot;Opened database successfully&quot;);</span>
<span class="fc" id="L51">        return c;</span>
    }

    /**
     * Creates the tables in the database.
     */
    private void createTables() {
<span class="fc" id="L58">        Connection c = this.connexion();</span>
        Statement stmt;
        try {
<span class="fc" id="L61">            stmt = c.createStatement();</span>
<span class="fc" id="L62">            String sql = &quot;CREATE TABLE IF NOT EXISTS Question (&quot;</span>
                    + &quot;id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,&quot;
                    + &quot;content VARCHAR(255) UNIQUE NOT NULL,&quot;
                    + &quot;id_video INTEGER NOT NULL,&quot;
                    + &quot;id_audio INTEGER NOT NULL,&quot;
                    + &quot;id_language INTEGER NOT NULL);&quot;
                    + &quot;CREATE TABLE IF NOT EXISTS Video (&quot;
                    + &quot;id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,&quot;
                    + &quot;name VARCHAR(50) UNIQUE NOT NULL,&quot;
                    + &quot;file_path VARCHAR(255) NOT NULL,&quot;
                    + &quot;id_language INTEGER NOT NULL,&quot;
                    + &quot;format VARCHAR(25));&quot;
                    + &quot;CREATE TABLE IF NOT EXISTS Audio (&quot;
                    + &quot;id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,&quot;
                    + &quot;name VARCHAR(50) UNIQUE NOT NULL,&quot;
                    + &quot;file_path VARCHAR(255) NOT NULL,&quot;
                    + &quot;id_language INTEGER NOT NULL,&quot;
                    + &quot;format VARCHAR(25));&quot;
                    + &quot;CREATE TABLE IF NOT EXISTS Language (&quot;
                    + &quot;id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,&quot;
                    + &quot;name VARCHAR(25) UNIQUE);&quot;;
<span class="fc" id="L83">            stmt.executeUpdate(sql);</span>
<span class="fc" id="L84">            stmt.close();</span>
<span class="fc" id="L85">            c.close();</span>
<span class="nc" id="L86">        } catch (SQLException e) {</span>
<span class="nc" id="L87">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L88">            System.exit(0);</span>
<span class="fc" id="L89">        }</span>
<span class="fc" id="L90">        System.out.println(&quot;[CreateTables]Tables created successfully&quot;);</span>
<span class="fc" id="L91">    }</span>

    /**
     * Adds a Video object (actually its metadata) in the database.
     *
     * @param name Video's name to add.
     * @param filePath Video's file path to add.
     * @param nameLanguage Video's language to add.
     * @param format Video's format to add.
     */
    public void addVideo(String name, String filePath, String format, String nameLanguage) {
<span class="fc" id="L102">        Connection c = this.connexion();</span>
<span class="fc" id="L103">        PreparedStatement stmtLang = null;</span>
<span class="fc" id="L104">        PreparedStatement stmtAdd = null;</span>
<span class="fc" id="L105">        int idLang = 0;</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">        if (this.searchVideoByNameFormat(name, format).getId() != 0) {</span>
<span class="fc" id="L107">            System.out.println(&quot;[addVideo]This video already exists.&quot;);</span>
        } else {
<span class="fc" id="L109">            String query = new String(&quot;SELECT id FROM Language WHERE Language.name=?;&quot;);</span>
            try {

<span class="fc" id="L112">                c.setAutoCommit(false);</span>
<span class="fc" id="L113">                System.out.println(&quot;[addVideo]Opened database successfully&quot;);</span>

                //Searching the language's id of the Video
<span class="fc" id="L116">                stmtLang = c.prepareStatement(query);</span>
<span class="fc" id="L117">                stmtLang.setString(1, nameLanguage);</span>
<span class="fc" id="L118">                ResultSet rs = stmtLang.executeQuery();</span>
<span class="fc bfc" id="L119" title="All 2 branches covered.">                while (rs.next()) {</span>
<span class="fc" id="L120">                    idLang = rs.getInt(&quot;id&quot;);</span>
                }

                //Adding the Video
<span class="fc" id="L124">                query = &quot;INSERT INTO Video(name,file_path,id_language,format) VALUES (?,?,?,?);&quot;;</span>
<span class="fc" id="L125">                stmtAdd = c.prepareStatement(query);</span>

<span class="fc" id="L127">                stmtAdd.setString(1, name);</span>
<span class="fc" id="L128">                stmtAdd.setString(2, filePath);</span>
<span class="fc" id="L129">                stmtAdd.setInt(3, idLang);</span>
<span class="fc" id="L130">                stmtAdd.setString(4, format);</span>
<span class="fc" id="L131">                stmtAdd.executeUpdate();</span>

<span class="fc" id="L133">                rs.close();</span>
<span class="fc" id="L134">                stmtLang.close();</span>
<span class="fc" id="L135">                stmtAdd.close();</span>
<span class="fc" id="L136">                c.commit();</span>
<span class="fc" id="L137">                c.close();</span>
<span class="nc" id="L138">            } catch (SQLException e) {</span>
<span class="nc" id="L139">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L140">                System.exit(0);</span>
<span class="fc" id="L141">            }</span>
<span class="fc" id="L142">            System.out.println(&quot;[addVideo]The video &quot; + name + &quot;.&quot; + format + &quot; successfuly added to the DB&quot;);</span>
        }
<span class="fc" id="L144">    }</span>

    /**
     * Adds a Audio object (actually its metadata) in the database.
     *
     * @param name Audio's name to add.
     * @param filePath Audio's file path to add.
     * @param nameLanguage Audio's language to add.
     * @param format Audio's format to add.
     */
    public void addAudio(String name, String filePath, String format, String nameLanguage) {
<span class="fc" id="L155">        Connection c = this.connexion();</span>
<span class="fc" id="L156">        PreparedStatement stmtLang = null;</span>
<span class="fc" id="L157">        PreparedStatement stmtAdd = null;</span>
<span class="fc" id="L158">        int idLang = 0;</span>
<span class="fc bfc" id="L159" title="All 2 branches covered.">        if (this.searchAudioByNameFormat(name, format).getId() != 0) {</span>
<span class="fc" id="L160">            System.out.println(&quot;[addAudio]This audio already exists.&quot;);</span>
        } else {
<span class="fc" id="L162">            String query = new String(&quot;SELECT id FROM Language WHERE Language.name=?;&quot;);</span>
            try {
<span class="fc" id="L164">                c.setAutoCommit(false);</span>
<span class="fc" id="L165">                System.out.println(&quot;[addAudio]Opened database successfully&quot;);</span>

                //Searching language's id of the audio
<span class="fc" id="L168">                stmtLang = c.prepareStatement(query);</span>
<span class="fc" id="L169">                stmtLang.setString(1, nameLanguage);</span>
<span class="fc" id="L170">                ResultSet rs = stmtLang.executeQuery();</span>
<span class="fc bfc" id="L171" title="All 2 branches covered.">                while (rs.next()) {</span>
<span class="fc" id="L172">                    idLang = rs.getInt(&quot;id&quot;);</span>
                }

                //Adding the Audio
<span class="fc" id="L176">                query = &quot;INSERT INTO Audio(name,file_path,id_language,format) VALUES (?,?,?,?);&quot;;</span>
<span class="fc" id="L177">                stmtAdd = c.prepareStatement(query);</span>

<span class="fc" id="L179">                stmtAdd.setString(1, name);</span>
<span class="fc" id="L180">                stmtAdd.setString(2, filePath);</span>
<span class="fc" id="L181">                stmtAdd.setInt(3, idLang);</span>
<span class="fc" id="L182">                stmtAdd.setString(4, format);</span>
<span class="fc" id="L183">                stmtAdd.executeUpdate();</span>

<span class="fc" id="L185">                rs.close();</span>
<span class="fc" id="L186">                stmtLang.close();</span>
<span class="fc" id="L187">                stmtAdd.close();</span>
<span class="fc" id="L188">                c.commit();</span>
<span class="fc" id="L189">                c.close();</span>
<span class="nc" id="L190">            } catch (SQLException e) {</span>
<span class="nc" id="L191">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L192">                System.exit(0);</span>
<span class="fc" id="L193">            }</span>
<span class="fc" id="L194">            System.out.println(&quot;[addAudio]The audio &quot; + name + &quot;.&quot; + format + &quot; successfuly added to the DB&quot;);</span>
        }
<span class="fc" id="L196">    }</span>

    /**
     * dds a Question object to the database.
     *
     * @param content Question's content.
     * @param video Question's Video expected.
     * @param audio Question's Audio expected.
     * @param nameLanguage Question's Language.
     */
    public void addQuestion(String content, Video video, Audio audio, String nameLanguage) {
<span class="fc" id="L207">        Connection c = this.connexion();</span>
<span class="fc" id="L208">        PreparedStatement stmtLang = null;</span>
<span class="fc" id="L209">        PreparedStatement stmtAdd = null;</span>
<span class="fc" id="L210">        int idLang = 0;</span>
<span class="fc bfc" id="L211" title="All 2 branches covered.">        if (this.searchQuestionByContent(content).getId() != 0) {</span>
<span class="fc" id="L212">            System.out.println(&quot;[addQuestion]This Question already exists.&quot;);</span>
        } else {
<span class="fc" id="L214">            String query = new String(&quot;SELECT id FROM Language WHERE Language.name=?;&quot;);</span>
            try {
<span class="fc" id="L216">                c.setAutoCommit(false);</span>
<span class="fc" id="L217">                System.out.println(&quot;[addQuestion]Opened database successfully&quot;);</span>

<span class="fc" id="L219">                stmtLang = c.prepareStatement(query);</span>

<span class="fc" id="L221">                stmtLang.setString(1, nameLanguage);</span>
<span class="fc" id="L222">                ResultSet rs = stmtLang.executeQuery();</span>
<span class="fc bfc" id="L223" title="All 2 branches covered.">                while (rs.next()) {</span>
<span class="fc" id="L224">                    idLang = rs.getInt(&quot;id&quot;);</span>
                }

<span class="fc" id="L227">                query = &quot;INSERT INTO Question (content,id_video,id_audio,id_language) VALUES (?,?,?,?);&quot;;</span>
<span class="fc" id="L228">                stmtAdd = c.prepareStatement(query);</span>
<span class="fc" id="L229">                stmtAdd.setString(1, content);</span>
<span class="fc" id="L230">                stmtAdd.setInt(2, video.getId());</span>
<span class="fc" id="L231">                stmtAdd.setInt(3, audio.getId());</span>
<span class="fc" id="L232">                stmtAdd.setInt(4, idLang);</span>
<span class="fc" id="L233">                stmtAdd.executeUpdate();</span>

<span class="fc" id="L235">                stmtLang.close();</span>
<span class="fc" id="L236">                stmtAdd.close();</span>
<span class="fc" id="L237">                c.commit();</span>
<span class="fc" id="L238">                c.close();</span>
<span class="nc" id="L239">            } catch (SQLException e) {</span>
<span class="nc" id="L240">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L241">                System.exit(0);</span>
<span class="fc" id="L242">            }</span>
<span class="fc" id="L243">            System.out.println(&quot;[addQuestion]The question \&quot;&quot; + content + &quot;\&quot; successfuly added.&quot;);</span>
        }
<span class="fc" id="L245">    }</span>

    /**
     * Adds a language in tha database.
     *
     * @param name The language in String type.
     */
    public void addLanguage(String name) {
<span class="fc" id="L253">        Connection c = this.connexion();</span>
<span class="fc" id="L254">        PreparedStatement stmt = null;</span>
<span class="fc bfc" id="L255" title="All 2 branches covered.">        if (this.searchLanguageByName(name).getId() != 0) {</span>
<span class="fc" id="L256">            System.out.println(&quot;[addLanguage]This language already exists.&quot;);</span>
        } else {
<span class="fc" id="L258">            String query = new String(&quot;INSERT INTO Language (name) VALUES (?);&quot;);</span>
            try {
<span class="fc" id="L260">                c.setAutoCommit(false);</span>
<span class="fc" id="L261">                System.out.println(&quot;[addLanguage]Opened database successfully&quot;);</span>

<span class="fc" id="L263">                stmt = c.prepareStatement(query);</span>
<span class="fc" id="L264">                stmt.setString(1, name);</span>
<span class="fc" id="L265">                stmt.executeUpdate();</span>

<span class="fc" id="L267">                stmt.close();</span>
<span class="fc" id="L268">                c.commit();</span>
<span class="fc" id="L269">                c.close();</span>
<span class="nc" id="L270">            } catch (SQLException e) {</span>
<span class="nc" id="L271">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L272">                System.exit(0);</span>
<span class="fc" id="L273">            }</span>
<span class="fc" id="L274">            System.out.println(&quot;[addLanguage]The language &quot; + name + &quot; successfuly added.&quot;);</span>
        }
<span class="fc" id="L276">    }</span>

    /**
     * Selects a random Video in the database, with the Language matching with
     * the paramater.
     *
     * @param language Video's Language wanted.
     * @return Video
     */
    public Video manageVideo(Language language) {
<span class="fc" id="L286">        Connection c = this.connexion();</span>
<span class="fc" id="L287">        PreparedStatement stmt = null;</span>
<span class="fc" id="L288">        Video result = new Video();</span>
<span class="fc" id="L289">        int idLanguage = language.getId();</span>
<span class="fc" id="L290">        String query = new String(&quot;SELECT * FROM Video WHERE id_language=? ORDER BY random() LIMIT 1;&quot;);</span>
        try {
<span class="fc" id="L292">            c.setAutoCommit(false);</span>
<span class="fc" id="L293">            System.out.println(&quot;[manageVideo]Opened database successfully&quot;);</span>

<span class="fc" id="L295">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L296">            stmt.setInt(1, idLanguage);</span>
<span class="fc" id="L297">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L299">                result = new Video(</span>
<span class="fc" id="L300">                        rs.getInt(&quot;id&quot;),</span>
<span class="fc" id="L301">                        rs.getString(&quot;name&quot;),</span>
<span class="fc" id="L302">                        rs.getString(&quot;file_path&quot;),</span>
<span class="fc" id="L303">                        rs.getString(&quot;format&quot;),</span>
<span class="fc" id="L304">                        rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="fc" id="L306">            rs.close();</span>
<span class="fc" id="L307">            stmt.close();</span>
<span class="fc" id="L308">            c.close();</span>
<span class="fc" id="L309">            return (result);</span>
<span class="nc" id="L310">        } catch (SQLException e) {</span>
<span class="nc" id="L311">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L312">            System.exit(0);</span>
        }
<span class="nc" id="L314">        System.out.println(&quot;[manageVideo]Error&quot;);</span>
<span class="nc" id="L315">        return (null);</span>
    }

    /**
     * Selects a random Audio in the database, with the Language matching with
     * the paramater.
     *
     * @param language Audio's Language wanted.
     * @return Audio
     */
    public Audio manageAudio(Language language) {
<span class="fc" id="L326">        Connection c = this.connexion();</span>
<span class="fc" id="L327">        PreparedStatement stmt = null;</span>
<span class="fc" id="L328">        Audio result = new Audio();</span>
<span class="fc" id="L329">        int idLanguage = language.getId();</span>
<span class="fc" id="L330">        String query = new String(&quot;SELECT * FROM Audio WHERE id_language=? ORDER BY random() LIMIT 1;&quot;);</span>
        try {
<span class="fc" id="L332">            c.setAutoCommit(false);</span>
<span class="fc" id="L333">            System.out.println(&quot;[manageAudio]Opened database successfully&quot;);</span>

<span class="fc" id="L335">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L336">            stmt.setInt(1, idLanguage);</span>
<span class="fc" id="L337">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L338" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L339">                result = new Audio(</span>
<span class="fc" id="L340">                        rs.getInt(&quot;id&quot;),</span>
<span class="fc" id="L341">                        rs.getString(&quot;name&quot;),</span>
<span class="fc" id="L342">                        rs.getString(&quot;file_path&quot;),</span>
<span class="fc" id="L343">                        rs.getString(&quot;format&quot;),</span>
<span class="fc" id="L344">                        rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="fc" id="L346">            rs.close();</span>
<span class="fc" id="L347">            stmt.close();</span>
<span class="fc" id="L348">            c.close();</span>
<span class="fc" id="L349">            return (result);</span>
<span class="nc" id="L350">        } catch (SQLException e) {</span>
<span class="nc" id="L351">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L352">            System.exit(0);</span>
        }
<span class="nc" id="L354">        System.out.println(&quot;[manageAudio]Error&quot;);</span>
<span class="nc" id="L355">        return (null);</span>
    }

    /**
     * Selects a random Question in the database, with the Language matching
     * with the paramater.
     *
     * @param language Question's Language wanted.
     * @return Question
     */
    public Question manageQuestion(Language language) {
<span class="fc" id="L366">        Connection c = this.connexion();</span>
<span class="fc" id="L367">        PreparedStatement stmt = null;</span>
<span class="fc" id="L368">        Question result = new Question();</span>
<span class="fc" id="L369">        int idLanguage = language.getId();</span>
<span class="fc" id="L370">        String query = new String(&quot;SELECT * FROM Question WHERE id_language=? ORDER BY random() LIMIT 1;&quot;);</span>
        try {
<span class="fc" id="L372">            c.setAutoCommit(false);</span>
<span class="fc" id="L373">            System.out.println(&quot;[manageQuestion]Opened database successfully&quot;);</span>
<span class="fc" id="L374">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L375">            stmt.setInt(1, idLanguage);</span>
<span class="fc" id="L376">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L377" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L378">                result = new Question(</span>
<span class="fc" id="L379">                        rs.getInt(&quot;id&quot;),</span>
<span class="fc" id="L380">                        rs.getString(&quot;content&quot;),</span>
<span class="fc" id="L381">                        rs.getInt(&quot;id_video&quot;),</span>
<span class="fc" id="L382">                        rs.getInt(&quot;id_audio&quot;),</span>
<span class="fc" id="L383">                        rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="fc" id="L385">            rs.close();</span>
<span class="fc" id="L386">            stmt.close();</span>
<span class="fc" id="L387">            c.close();</span>
<span class="fc" id="L388">            return (result);</span>
<span class="nc" id="L389">        } catch (SQLException e) {</span>
<span class="nc" id="L390">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L391">            System.exit(0);</span>
        }
<span class="nc" id="L393">        System.out.println(&quot;[manageQuestion]Error&quot;);</span>
<span class="nc" id="L394">        return (null);</span>
    }

    /**
     * Searches a Langugae in the database by its name.
     *
     * @param name Language's name to search.
     * @return Language
     */
    public Language searchLanguageByName(String name) {
<span class="fc" id="L404">        Connection c = this.connexion();</span>
<span class="fc" id="L405">        PreparedStatement stmt = null;</span>
<span class="fc" id="L406">        Language language = new Language();</span>
<span class="fc" id="L407">        String query = new String(&quot;SELECT * FROM Language WHERE Language.name=?;&quot;);</span>
        try {
<span class="fc" id="L409">            c.setAutoCommit(false);</span>
<span class="fc" id="L410">            System.out.println(&quot;[searchLanguageByName]Opened database successfully&quot;);</span>

<span class="fc" id="L412">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L413">            stmt.setString(1, name);</span>
<span class="fc" id="L414">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L415" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L416">                language.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L417">                language.setName(rs.getString(&quot;name&quot;));</span>
            }
<span class="fc" id="L419">            rs.close();</span>
<span class="fc" id="L420">            stmt.close();</span>
<span class="fc" id="L421">            c.close();</span>
<span class="fc" id="L422">            return (language);</span>
<span class="nc" id="L423">        } catch (SQLException e) {</span>
<span class="nc" id="L424">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L426">        System.out.println(&quot;[searchLanguageByName]Error&quot;);</span>
<span class="nc" id="L427">        return (null);</span>
    }

    /**
     * Searches a Video in the database by its name and its format, if not
     * found, returns an object with a id = 0.
     *
     * @param name Video's name searched.
     * @param format Video's format searched.
     * @return Video
     */
    public Video searchVideoByNameFormat(String name, String format) {
<span class="fc" id="L439">        Connection c = this.connexion();</span>
<span class="fc" id="L440">        PreparedStatement stmt = null;</span>
<span class="fc" id="L441">        Video video = new Video();</span>
<span class="fc" id="L442">        String query = new String(&quot;SELECT * FROM Video WHERE Video.name=? AND Video.format=?;&quot;);</span>
        try {

<span class="fc" id="L445">            c.setAutoCommit(false);</span>
<span class="fc" id="L446">            System.out.println(&quot;[searchVideoByNameFormat]Opened database successfully&quot;);</span>

<span class="fc" id="L448">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L449">            stmt.setString(1, name);</span>
<span class="fc" id="L450">            stmt.setString(2, format);</span>
<span class="fc" id="L451">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L452" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L453">                video.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L454">                video.setName(rs.getString(&quot;name&quot;));</span>
<span class="fc" id="L455">                video.setFormat(rs.getString(&quot;format&quot;));</span>
<span class="fc" id="L456">                video.setFilePath(rs.getString(&quot;file_path&quot;));</span>
<span class="fc" id="L457">                video.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="fc" id="L459">            rs.close();</span>
<span class="fc" id="L460">            stmt.close();</span>
<span class="fc" id="L461">            c.close();</span>
<span class="fc" id="L462">            return (video);</span>
<span class="nc" id="L463">        } catch (SQLException e) {</span>
<span class="nc" id="L464">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L466">        System.out.println(&quot;[searchVideoByNameFormat]Error&quot;);</span>
<span class="nc" id="L467">        return (null);</span>
    }

    /**
     * Searches a Audio in the database by its name and its format, if not
     * found, returns an object with a id = 0.
     *
     * @param name Audio's name searched.
     * @param format Audio's format searched.
     * @return Audio
     */
    public Audio searchAudioByNameFormat(String name, String format) {
<span class="fc" id="L479">        Connection c = this.connexion();</span>
<span class="fc" id="L480">        PreparedStatement stmt = null;</span>
<span class="fc" id="L481">        Audio audio = new Audio();</span>
<span class="fc" id="L482">        String query = new String(&quot;SELECT * FROM Audio WHERE Audio.name=? AND Audio.format=?;&quot;);</span>
        try {
<span class="fc" id="L484">            c.setAutoCommit(false);</span>
<span class="fc" id="L485">            System.out.println(&quot;[searchAudioByNameFormat]Opened database successfully&quot;);</span>

<span class="fc" id="L487">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L488">            stmt.setString(1, name);</span>
<span class="fc" id="L489">            stmt.setString(2, format);</span>
<span class="fc" id="L490">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L491" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L492">                audio.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L493">                audio.setName(rs.getString(&quot;name&quot;));</span>
<span class="fc" id="L494">                audio.setFormat(rs.getString(&quot;format&quot;));</span>
<span class="fc" id="L495">                audio.setFilePath(rs.getString(&quot;file_path&quot;));</span>
<span class="fc" id="L496">                audio.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="fc" id="L498">            rs.close();</span>
<span class="fc" id="L499">            stmt.close();</span>
<span class="fc" id="L500">            c.close();</span>
<span class="fc" id="L501">            return (audio);</span>
<span class="nc" id="L502">        } catch (SQLException e) {</span>
<span class="nc" id="L503">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L505">        System.out.println(&quot;[searchAudioByNameFormat]Error&quot;);</span>
<span class="nc" id="L506">        return (null);</span>
    }

    /**
     * Searches a Question in the database by its content, if not found, returns
     * an object with a id = 0.
     *
     * @param content Question's content searched.
     * @return Question
     */
    public Question searchQuestionByContent(String content) {
<span class="fc" id="L517">        Connection c = this.connexion();</span>
<span class="fc" id="L518">        PreparedStatement stmt = null;</span>
<span class="fc" id="L519">        Question question = new Question();</span>
<span class="fc" id="L520">        String query = new String(&quot;SELECT * FROM Question WHERE Question.content=?;&quot;);</span>
        try {
<span class="fc" id="L522">            c.setAutoCommit(false);</span>
<span class="fc" id="L523">            System.out.println(&quot;[searchQuestionByContent]Opened database successfully&quot;);</span>

<span class="fc" id="L525">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L526">            stmt.setString(1, content);</span>
<span class="fc" id="L527">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L528" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L529">                question.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L530">                question.setContent(rs.getString(&quot;content&quot;));</span>
<span class="fc" id="L531">                question.setIdVideo(rs.getInt(&quot;id_video&quot;));</span>
<span class="fc" id="L532">                question.setIdAudio(rs.getInt(&quot;id_audio&quot;));</span>
<span class="fc" id="L533">                question.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="fc" id="L535">            rs.close();</span>
<span class="fc" id="L536">            stmt.close();</span>
<span class="fc" id="L537">            c.close();</span>
<span class="fc" id="L538">            return (question);</span>
<span class="nc" id="L539">        } catch (SQLException e) {</span>
<span class="nc" id="L540">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L542">        System.out.println(&quot;[searchQuestionByContent]Error&quot;);</span>
<span class="nc" id="L543">        return (null);</span>
    }

    /**
     * Returns a ArrayList of Question of all the questions in the database.
     *
     * @return ArrayList\&lt;Question\&gt;
     */
    public ArrayList&lt;Question&gt; getAllQuestions() {
<span class="nc" id="L552">        Connection c = this.connexion();</span>
<span class="nc" id="L553">        PreparedStatement stmt = null;</span>
        ArrayList&lt;Question&gt; result;
<span class="nc" id="L555">        result = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L556">        Question tempQuestion = new Question();</span>
<span class="nc" id="L557">        String query = new String(&quot;SELECT * FROM Question;&quot;);</span>
        try {

<span class="nc" id="L560">            c.setAutoCommit(false);</span>
<span class="nc" id="L561">            System.out.println(&quot;[getAllQuestions]Opened database successfully&quot;);</span>

<span class="nc" id="L563">            stmt = c.prepareStatement(query);</span>
<span class="nc" id="L564">            ResultSet rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">            while (rs.next()) {</span>
<span class="nc" id="L566">                tempQuestion = new Question();</span>
<span class="nc" id="L567">                tempQuestion.setId(rs.getInt(&quot;id&quot;));</span>
<span class="nc" id="L568">                tempQuestion.setContent(rs.getString(&quot;content&quot;));</span>
<span class="nc" id="L569">                tempQuestion.setIdVideo(rs.getInt(&quot;id_video&quot;));</span>
<span class="nc" id="L570">                tempQuestion.setIdAudio(rs.getInt(&quot;id_audio&quot;));</span>
<span class="nc" id="L571">                tempQuestion.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
                //Transfering tempQuestion into the ArrayList
<span class="nc" id="L573">                result.add(tempQuestion);</span>
            }
<span class="nc" id="L575">            rs.close();</span>
<span class="nc" id="L576">            stmt.close();</span>
<span class="nc" id="L577">            c.close();</span>
<span class="nc" id="L578">            return (result);</span>
<span class="nc" id="L579">        } catch (SQLException e) {</span>
<span class="nc" id="L580">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L582">        System.out.println(&quot;[getAllQuestions]Error&quot;);</span>
<span class="nc" id="L583">        return (null);</span>
    }

    /**
     * Returns a ArrayList of Video of all the videos in the database.
     *
     * @return ArrayList\&lt;Video\&gt;
     */
    public ArrayList&lt;Video&gt; getAllVideos() {
<span class="fc" id="L592">        Connection c = this.connexion();</span>
<span class="fc" id="L593">        PreparedStatement stmt = null;</span>
        ArrayList&lt;Video&gt; result;
<span class="fc" id="L595">        result = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L596">        Video tempVideo = new Video();</span>
<span class="fc" id="L597">        String query = new String(&quot;SELECT * FROM Video;&quot;);</span>
        try {
<span class="fc" id="L599">            c.setAutoCommit(false);</span>
<span class="fc" id="L600">            System.out.println(&quot;[getAllVideo]Opened database successfully&quot;);</span>

<span class="fc" id="L602">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L603">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L604" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L605">                tempVideo = new Video();</span>
<span class="fc" id="L606">                tempVideo.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L607">                tempVideo.setName(rs.getString(&quot;name&quot;));</span>
<span class="fc" id="L608">                tempVideo.setFilePath(rs.getString(&quot;file_path&quot;));</span>
<span class="fc" id="L609">                tempVideo.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
<span class="fc" id="L610">                tempVideo.setFormat(rs.getString(&quot;format&quot;));</span>
                //Transfering tempVideo into the ArrayList
<span class="fc" id="L612">                result.add(tempVideo);</span>
            }
<span class="fc" id="L614">            rs.close();</span>
<span class="fc" id="L615">            stmt.close();</span>
<span class="fc" id="L616">            c.close();</span>
<span class="fc" id="L617">            return (result);</span>
<span class="nc" id="L618">        } catch (SQLException e) {</span>
<span class="nc" id="L619">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L621">        System.out.println(&quot;[getAllVideos]Error&quot;);</span>
<span class="nc" id="L622">        return (null);</span>
    }

    /**
     * Returns a ArrayList of Audio of all the audios in the database.
     *
     * @return ArrayList\&lt;Audio\&gt;
     */
    public ArrayList&lt;Audio&gt; getAllAudios() {
<span class="fc" id="L631">        Connection c = this.connexion();</span>
<span class="fc" id="L632">        PreparedStatement stmt = null;</span>
        ArrayList&lt;Audio&gt; result;
<span class="fc" id="L634">        result = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L635">        Audio tempAudio = new Audio();</span>
<span class="fc" id="L636">        String query = new String(&quot;SELECT * FROM Audio;&quot;);</span>
        try {
<span class="fc" id="L638">            c.setAutoCommit(false);</span>
<span class="fc" id="L639">            System.out.println(&quot;[getAllAudio]Opened database successfully&quot;);</span>

<span class="fc" id="L641">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L642">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L643" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L644">                tempAudio = new Audio();</span>
<span class="fc" id="L645">                tempAudio.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L646">                tempAudio.setName(rs.getString(&quot;name&quot;));</span>
<span class="fc" id="L647">                tempAudio.setFilePath(rs.getString(&quot;file_path&quot;));</span>
<span class="fc" id="L648">                tempAudio.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
<span class="fc" id="L649">                tempAudio.setFormat(rs.getString(&quot;format&quot;));</span>
                //Transfering tempAudio into the ArrayList
<span class="fc" id="L651">                result.add(tempAudio);</span>
            }
<span class="fc" id="L653">            rs.close();</span>
<span class="fc" id="L654">            stmt.close();</span>
<span class="fc" id="L655">            c.close();</span>
<span class="fc" id="L656">            return (result);</span>
<span class="nc" id="L657">        } catch (SQLException e) {</span>
<span class="nc" id="L658">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L660">        System.out.println(&quot;[getAllAudios]Error&quot;);</span>
<span class="nc" id="L661">        return (null);</span>
    }

    /**
     * Returns a ArrayList of Language of all the languages in the database.
     *
     * @return ArrayList\&lt;Language\&gt;
     */
    public ArrayList&lt;Language&gt; getAllLanguages() {
<span class="fc" id="L670">        Connection c = this.connexion();</span>
<span class="fc" id="L671">        PreparedStatement stmt = null;</span>
        ArrayList&lt;Language&gt; result;
<span class="fc" id="L673">        result = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L674">        Language tempLanguage = new Language();</span>
<span class="fc" id="L675">        String query = new String(&quot;SELECT * FROM Language;&quot;);</span>
        try {
<span class="fc" id="L677">            c.setAutoCommit(false);</span>
<span class="fc" id="L678">            System.out.println(&quot;[getAllLanguages]Opened database successfully&quot;);</span>

<span class="fc" id="L680">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L681">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L682" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L683">                tempLanguage = new Language();</span>
<span class="fc" id="L684">                tempLanguage.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L685">                tempLanguage.setName(rs.getString(&quot;name&quot;));</span>
                //Transfering tempLanguage into the ArrayList
<span class="fc" id="L687">                result.add(tempLanguage);</span>
            }
<span class="fc" id="L689">            rs.close();</span>
<span class="fc" id="L690">            stmt.close();</span>
<span class="fc" id="L691">            c.close();</span>
<span class="fc" id="L692">            return (result);</span>
<span class="nc" id="L693">        } catch (SQLException e) {</span>
<span class="nc" id="L694">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L696">        System.out.println(&quot;[getAllLanguages]Error&quot;);</span>
<span class="nc" id="L697">        return (null);</span>
    }

    /**
     * Counts the amount of languages in the database Audio table with the
     * idLanguage matching with the parameter.
     *
     * @param idLanguage Audios idLanguage to search.
     * @return int
     */
    public int countAudio(int idLanguage) {
<span class="fc" id="L708">        int result = 0;</span>

<span class="fc" id="L710">        Connection c = this.connexion();</span>
<span class="fc" id="L711">        PreparedStatement stmt = null;</span>
<span class="fc" id="L712">        String query = new String(&quot;SELECT COUNT(*) AS rowcount FROM Audio where id_language = ? ;&quot;);</span>
        try {
<span class="fc" id="L714">            c.setAutoCommit(false);</span>
<span class="fc" id="L715">            System.out.println(&quot;[countAudio]Opened database successfully&quot;);</span>

<span class="fc" id="L717">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L718">            stmt.setInt(1, idLanguage);</span>
<span class="fc" id="L719">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L720" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L721">                result = rs.getInt(&quot;rowcount&quot;);</span>
            }
<span class="fc" id="L723">            rs.close();</span>
<span class="fc" id="L724">            stmt.close();</span>
<span class="fc" id="L725">            c.close();</span>
<span class="nc" id="L726">        } catch (SQLException e) {</span>
<span class="nc" id="L727">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="fc" id="L728">        }</span>
<span class="fc" id="L729">        return result;</span>
    }

    /**
     * Counts the amount of languages in the database Question table with the
     * idLanguage matching with the parameter.
     *
     * @param idLanguage Question idLanguage to search.
     * @return int
     */
    public int countQuestion(int idLanguage) {
<span class="fc" id="L740">        int result = 0;</span>

<span class="fc" id="L742">        Connection c = this.connexion();</span>
<span class="fc" id="L743">        PreparedStatement stmt = null;</span>
<span class="fc" id="L744">        String query = new String(&quot;SELECT COUNT(*) AS rowcount FROM Question where id_language=?;&quot;);</span>
        try {
<span class="fc" id="L746">            c.setAutoCommit(false);</span>
<span class="fc" id="L747">            System.out.println(&quot;[CountQuestion]Opened database successfully&quot;);</span>

<span class="fc" id="L749">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L750">            stmt.setInt(1, idLanguage);</span>
<span class="fc" id="L751">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L752" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L753">                result = rs.getInt(&quot;rowcount&quot;);</span>
            }
<span class="fc" id="L755">            rs.close();</span>
<span class="fc" id="L756">            stmt.close();</span>
<span class="fc" id="L757">            c.close();</span>
<span class="nc" id="L758">        } catch (SQLException e) {</span>
<span class="nc" id="L759">            System.out.println(&quot;erreurs&quot;);</span>
<span class="fc" id="L760">        }</span>

<span class="fc" id="L762">        return result;</span>
    }

    /**
     * Counts the amount of languages in the database Video table with the
     * idLanguage matching with the parameter.
     *
     * @param idLanguage Video idLanguage to search.
     * @return int
     */
    public int countVideo(int idLanguage) {
<span class="fc" id="L773">        int result = 0;</span>

<span class="fc" id="L775">        Connection c = this.connexion();</span>
<span class="fc" id="L776">        PreparedStatement stmt = null;</span>
<span class="fc" id="L777">        String query = new String(&quot;SELECT COUNT(*) AS rowcount FROM Video where id_language = ? ;&quot;);</span>
        try {
<span class="fc" id="L779">            c.setAutoCommit(false);</span>
<span class="fc" id="L780">            stmt = c.prepareStatement(query);</span>
<span class="fc" id="L781">            stmt.setInt(1, idLanguage);</span>
<span class="fc" id="L782">            ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L783" title="All 2 branches covered.">            while (rs.next()) {</span>
<span class="fc" id="L784">                result = rs.getInt(&quot;rowcount&quot;);</span>
            }
<span class="fc" id="L786">            rs.close();</span>
<span class="fc" id="L787">            stmt.close();</span>
<span class="fc" id="L788">            c.close();</span>
<span class="nc" id="L789">        } catch (SQLException e) {</span>
<span class="nc" id="L790">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="fc" id="L791">        }</span>

<span class="fc" id="L793">        return result;</span>
    }

    /**
     * Removes a Video from the database knowing its name and format.
     *
     * @param videoName Video's name to remove.
     * @param format Video's format to remove.
     */
    public void rmVideo(String videoName, String format) {
<span class="fc" id="L803">        Connection c = this.connexion();</span>
<span class="fc" id="L804">        PreparedStatement stmtCheck = null;</span>
<span class="fc" id="L805">        PreparedStatement stmtRm = null;</span>
<span class="fc" id="L806">        int idLang = 0;</span>
<span class="fc" id="L807">        Question tmpQuestion = new Question();</span>
<span class="fc" id="L808">        Video tmp = new Video(this.searchVideoByNameFormat(videoName, format));</span>
<span class="fc bfc" id="L809" title="All 2 branches covered.">        if (tmp.getId() == 0) {</span>
<span class="fc" id="L810">            System.out.println(&quot;[rmVideo]This video doesn't exist.&quot;);</span>
        } else {
            try {
<span class="fc" id="L813">                c.setAutoCommit(false);</span>
<span class="fc" id="L814">                System.out.println(&quot;[rmVideo]Opened database successfully&quot;);</span>

                //Looking for a Question using the video we want to remove
<span class="fc" id="L817">                String query = &quot;SELECT id, content, id_audio, id_video, id_language FROM Question WHERE id_video=?&quot;;</span>
<span class="fc" id="L818">                stmtCheck = c.prepareStatement(query);</span>

<span class="fc" id="L820">                stmtCheck.setInt(1, tmp.getId());</span>
<span class="fc" id="L821">                ResultSet rs = stmtCheck.executeQuery();</span>
<span class="fc bfc" id="L822" title="All 2 branches covered.">                while (rs.next()) {</span>
<span class="fc" id="L823">                    tmpQuestion.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L824">                    tmpQuestion.setContent(rs.getString(&quot;content&quot;));</span>
<span class="fc" id="L825">                    tmpQuestion.setIdAudio(rs.getInt(&quot;id_audio&quot;));</span>
<span class="fc" id="L826">                    tmpQuestion.setIdVideo(rs.getInt(&quot;id_video&quot;));</span>
<span class="fc" id="L827">                    tmpQuestion.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
                }
<span class="fc" id="L829">                rs.close();</span>
<span class="fc" id="L830">                stmtCheck.close();</span>

<span class="fc bfc" id="L832" title="All 2 branches covered.">                if (tmpQuestion.getId() == 0) {</span>
                    //Removing the Audio
<span class="fc" id="L834">                    query = &quot;DELETE FROM Video WHERE id=?;&quot;;</span>
<span class="fc" id="L835">                    stmtRm = c.prepareStatement(query);</span>

<span class="fc" id="L837">                    stmtRm.setInt(1, tmp.getId());</span>
<span class="fc" id="L838">                    stmtRm.executeUpdate();</span>
<span class="fc" id="L839">                    c.commit();</span>
<span class="fc" id="L840">                    stmtRm.close();</span>
                } else {
<span class="fc" id="L842">                    System.out.println(&quot;Video cannot be removed, it is linked to the following question :\n&quot; + tmpQuestion.toString());</span>
                }
<span class="fc" id="L844">                c.commit();</span>
<span class="fc" id="L845">                c.close();</span>
<span class="nc" id="L846">            } catch (SQLException e) {</span>
<span class="nc" id="L847">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L848">                System.exit(0);</span>
<span class="fc" id="L849">            }</span>
<span class="fc" id="L850">            System.out.println(&quot;[rmVideo]The video &quot; + tmp.getName() + &quot;.&quot; + tmp.getFormat() + &quot; successfuly removed from the DB&quot;);</span>
        }
<span class="fc" id="L852">    }</span>

    /**
     * Removes a Audio from the database knowing its name and format.
     *
     * @param audioName Audio's name to remove.
     * @param format Audio's format to remove.
     */
    public void rmAudio(String audioName, String format) {
<span class="fc" id="L861">        Connection c = this.connexion();</span>
<span class="fc" id="L862">        PreparedStatement stmtCheck = null;</span>
<span class="fc" id="L863">        PreparedStatement stmtRm = null;</span>
<span class="fc" id="L864">        int idLang = 0;</span>
<span class="fc" id="L865">        Question tmpQuestion = new Question();</span>
<span class="fc" id="L866">        Audio tmp = new Audio(this.searchAudioByNameFormat(audioName, format));</span>
<span class="fc bfc" id="L867" title="All 2 branches covered.">        if (tmp.getId() == 0) {</span>
<span class="fc" id="L868">            System.out.println(&quot;[rmAudio]This video doesn't exist.&quot;);</span>
        } else {
            try {
<span class="fc" id="L871">                c.setAutoCommit(false);</span>
<span class="fc" id="L872">                System.out.println(&quot;[rmAudio]Opened database successfully&quot;);</span>

                //Looking for a Question using the audio we want to remove
<span class="fc" id="L875">                String query = &quot;SELECT id, content, id_audio, id_video, id_language FROM Question WHERE id_audio=?&quot;;</span>
<span class="fc" id="L876">                stmtCheck = c.prepareStatement(query);</span>

<span class="fc" id="L878">                stmtCheck.setInt(1, tmp.getId());</span>
<span class="fc" id="L879">                ResultSet rs = stmtCheck.executeQuery();</span>
<span class="fc bfc" id="L880" title="All 2 branches covered.">                while (rs.next()) {</span>
<span class="fc" id="L881">                    tmpQuestion.setId(rs.getInt(&quot;id&quot;));</span>
<span class="fc" id="L882">                    tmpQuestion.setContent(rs.getString(&quot;content&quot;));</span>
<span class="fc" id="L883">                    tmpQuestion.setIdAudio(rs.getInt(&quot;id_audio&quot;));</span>
<span class="fc" id="L884">                    tmpQuestion.setIdVideo(rs.getInt(&quot;id_video&quot;));</span>
<span class="fc" id="L885">                    tmpQuestion.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
                }
<span class="fc" id="L887">                rs.close();</span>
<span class="fc" id="L888">                stmtCheck.close();</span>

<span class="fc bfc" id="L890" title="All 2 branches covered.">                if (tmpQuestion.getId() == 0) {</span>
                    //Removing the Audio
<span class="fc" id="L892">                    query = &quot;DELETE FROM Audio WHERE id=?;&quot;;</span>
<span class="fc" id="L893">                    stmtRm = c.prepareStatement(query);</span>

<span class="fc" id="L895">                    stmtRm.setInt(1, tmp.getId());</span>
<span class="fc" id="L896">                    stmtRm.executeUpdate();</span>
<span class="fc" id="L897">                    c.commit();</span>
<span class="fc" id="L898">                    stmtRm.close();</span>
                } else {
<span class="fc" id="L900">                    System.out.println(&quot;Audio cannot be removed, it is linked to the following question :\n&quot; + tmpQuestion.toString());</span>
                }
<span class="fc" id="L902">                c.commit();</span>
<span class="fc" id="L903">                c.close();</span>
<span class="nc" id="L904">            } catch (SQLException e) {</span>
<span class="nc" id="L905">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L906">                System.exit(0);</span>
<span class="fc" id="L907">            }</span>
<span class="fc" id="L908">            System.out.println(&quot;[rmAudio]The audio &quot; + tmp.getName() + &quot;.&quot; + tmp.getFormat() + &quot; successfuly removed from the DB&quot;);</span>
        }
<span class="fc" id="L910">    }</span>

    /**
     * Removes a Language from the database knowing its name.
     *
     * @param languageName Language's name to remove.
     */
    public void rmLanguage(String languageName) {
<span class="fc" id="L918">        Connection c = this.connexion();</span>
<span class="fc" id="L919">        PreparedStatement stmtCheck = null;</span>
<span class="fc" id="L920">        PreparedStatement stmtRm = null;</span>
<span class="fc" id="L921">        Language tmp = new Language(this.searchLanguageByName(languageName).getId(),this.searchLanguageByName(languageName).getName());</span>
<span class="fc" id="L922">        Audio audio = null;</span>
<span class="fc" id="L923">        Video video = null;</span>
<span class="fc bfc" id="L924" title="All 2 branches covered.">        if (tmp.getId() == 0) {</span>
<span class="fc" id="L925">            System.out.println(&quot;[rmLanguage]This language doesn't exist.&quot;);</span>
        } else {
            try {
<span class="fc" id="L928">                c.setAutoCommit(false);</span>
<span class="fc" id="L929">                System.out.println(&quot;[rmLanguage]Opened database successfully&quot;);</span>

<span class="fc" id="L931">                String query =  &quot;SELECT id, name, file_path, id_language, format FROM Audio WHERE id_language=?&quot;;</span>
<span class="fc" id="L932">                stmtCheck = c.prepareStatement(query);</span>
<span class="fc" id="L933">                stmtCheck.setInt(1, tmp.getId());</span>
<span class="fc" id="L934">                ResultSet rs = stmtCheck.executeQuery();</span>
<span class="pc bpc" id="L935" title="1 of 2 branches missed.">                while (rs.next()) {</span>
<span class="nc" id="L936">                    audio.setId(rs.getInt(&quot;id&quot;));</span>
                }
<span class="fc" id="L938">                rs.close();</span>
<span class="fc" id="L939">                stmtCheck.close();</span>

                //Looking for a Question using the audio we want to remove
<span class="fc" id="L942">                String query2 =  &quot;SELECT id, name, file_path, id_language, format FROM Audio WHERE id_language=?&quot;;</span>
<span class="fc" id="L943">                stmtCheck = c.prepareStatement(query2);</span>
<span class="fc" id="L944">                stmtCheck.setInt(1, tmp.getId());</span>
<span class="fc" id="L945">                ResultSet rs2 = stmtCheck.executeQuery();</span>
<span class="pc bpc" id="L946" title="1 of 2 branches missed.">                while (rs2.next()) {</span>
<span class="nc" id="L947">                    video.setId(rs2.getInt(&quot;id&quot;));</span>
                }
<span class="fc" id="L949">                rs2.close();</span>
<span class="fc" id="L950">                stmtCheck.close();</span>

<span class="pc bpc" id="L952" title="2 of 4 branches missed.">                if (audio == null &amp;&amp; video == null) {</span>
                    //Removing the language
<span class="fc" id="L954">                    query = &quot;DELETE FROM Language WHERE id=?;&quot;;</span>
<span class="fc" id="L955">                    stmtRm = c.prepareStatement(query);</span>

<span class="fc" id="L957">                    stmtRm.setInt(1, tmp.getId());</span>
<span class="fc" id="L958">                    stmtRm.executeUpdate();</span>
<span class="fc" id="L959">                    c.commit();</span>
<span class="fc" id="L960">                    stmtRm.close();</span>
                } else {
<span class="nc" id="L962">                    System.out.println(&quot;Language cannot be removed, it is linked to the following language :\n&quot; + audio.toString() + video.toString());</span>
                }
<span class="fc" id="L964">                c.commit();</span>
<span class="fc" id="L965">                c.close();</span>

<span class="nc" id="L967">            } catch (SQLException e) {</span>
<span class="nc" id="L968">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L969">                System.exit(0);</span>
<span class="fc" id="L970">            }</span>
        }
<span class="fc" id="L972">    }</span>

    /**
     * Removes a Question from the database knowing its content.
     * @param content Question's content.
     */
    public void rmQuestion(String content) {
<span class="nc" id="L979">        Connection c = this.connexion();</span>
<span class="nc" id="L980">        PreparedStatement stmtCheck = null;</span>
<span class="nc" id="L981">        PreparedStatement stmtRm = null;</span>
<span class="nc" id="L982">        Question tmp = new Question(this.searchQuestionByContent(content));</span>
<span class="nc" id="L983">        Audio audio = null;</span>
<span class="nc" id="L984">        Video video = null;</span>
<span class="nc bnc" id="L985" title="All 2 branches missed.">        if (tmp.getId() == 0) {</span>
<span class="nc" id="L986">            System.out.println(&quot;[rmQuestion]This language doesn't exist.&quot;);</span>
        } else {
            try {
<span class="nc" id="L989">                c.setAutoCommit(false);</span>
<span class="nc" id="L990">                System.out.println(&quot;[rmQuestion]Opened database successfully&quot;);</span>

<span class="nc" id="L992">                String query =  &quot;SELECT id, name, file_path, id_language, format FROM Audio WHERE id_language=?&quot;;</span>
<span class="nc" id="L993">                stmtCheck = c.prepareStatement(query);</span>
<span class="nc" id="L994">                stmtCheck.setInt(1, tmp.getId());</span>
<span class="nc" id="L995">                ResultSet rs = stmtCheck.executeQuery();</span>
<span class="nc bnc" id="L996" title="All 2 branches missed.">                while (rs.next()) {</span>
<span class="nc" id="L997">                    audio.setId(rs.getInt(&quot;id&quot;));</span>
                }
<span class="nc" id="L999">                rs.close();</span>
<span class="nc" id="L1000">                stmtCheck.close();</span>

                //Looking for a Question using the audio we want to remove
<span class="nc" id="L1003">                String query2 =  &quot;SELECT id, name, file_path, id_language, format FROM Audio WHERE id_language=?&quot;;</span>
<span class="nc" id="L1004">                stmtCheck = c.prepareStatement(query2);</span>
<span class="nc" id="L1005">                stmtCheck.setInt(1, tmp.getId());</span>
<span class="nc" id="L1006">                ResultSet rs2 = stmtCheck.executeQuery();</span>
<span class="nc bnc" id="L1007" title="All 2 branches missed.">                while (rs2.next()) {</span>
<span class="nc" id="L1008">                    video.setId(rs2.getInt(&quot;id&quot;));</span>
                }
<span class="nc" id="L1010">                rs2.close();</span>
<span class="nc" id="L1011">                stmtCheck.close();</span>

<span class="nc bnc" id="L1013" title="All 4 branches missed.">                if (audio == null &amp;&amp; video == null) {</span>
                    //Removing the language
<span class="nc" id="L1015">                    query = &quot;DELETE FROM Language WHERE id=?;&quot;;</span>
<span class="nc" id="L1016">                    stmtRm = c.prepareStatement(query);</span>

<span class="nc" id="L1018">                    stmtRm.setInt(1, tmp.getId());</span>
<span class="nc" id="L1019">                    stmtRm.executeUpdate();</span>
<span class="nc" id="L1020">                    c.commit();</span>
<span class="nc" id="L1021">                    stmtRm.close();</span>
                } else {
<span class="nc" id="L1023">                    System.out.println(&quot;Question cannot be removed, it is linked to the following question :\n&quot; + audio.toString() + video.toString());</span>
                }
<span class="nc" id="L1025">                c.commit();</span>
<span class="nc" id="L1026">                c.close();</span>

<span class="nc" id="L1028">            } catch (SQLException e) {</span>
<span class="nc" id="L1029">                System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L1030">                System.exit(0);</span>
<span class="nc" id="L1031">            }</span>
        }
<span class="nc" id="L1033">    }</span>

    /**
     * Returns the name of the language which the id is in parameter, returns
     * null if the language doesn't exist.
     *
     * @param id Language's id.
     * @return String
     */
    public String getLanguageById(int id) {
<span class="nc" id="L1043">        Connection c = this.connexion();</span>
<span class="nc" id="L1044">        PreparedStatement stmt = null;</span>
<span class="nc" id="L1045">        String result = null;</span>
        try {
<span class="nc" id="L1047">            c.setAutoCommit(false);</span>
<span class="nc" id="L1048">            System.out.println(&quot;[getLanguageById]Opened database successfully&quot;);</span>

<span class="nc" id="L1050">            String query = &quot;SELECT name FROM Language WHERE id=?;&quot;;</span>
<span class="nc" id="L1051">            stmt = c.prepareStatement(query);</span>
<span class="nc" id="L1052">            stmt.setInt(1, id);</span>
<span class="nc" id="L1053">            ResultSet rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">            while (rs.next()) {</span>
<span class="nc" id="L1055">                result = rs.getString(&quot;name&quot;);</span>
            }
<span class="nc" id="L1057">            rs.close();</span>
<span class="nc" id="L1058">            stmt.close();</span>
<span class="nc" id="L1059">            c.close();</span>
<span class="nc" id="L1060">            return (result);</span>

<span class="nc" id="L1062">        } catch (SQLException e) {</span>
<span class="nc" id="L1063">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
<span class="nc" id="L1064">            System.exit(0);</span>
        }

<span class="nc" id="L1067">        return &quot;&quot;;</span>
    }

    /**
     * Searches and returns a Video object by its id, returns a Video object
     * with id = 0 if not found.
     *
     * @param id Video's id to search.
     * @return Video
     */
    public Video searchVideoById(int id) {
<span class="nc" id="L1078">        Connection c = this.connexion();</span>
<span class="nc" id="L1079">        PreparedStatement stmt = null;</span>
<span class="nc" id="L1080">        Video video = new Video();</span>
<span class="nc" id="L1081">        String query = new String(&quot;SELECT * FROM Video WHERE Video.id=?;&quot;);</span>
        try {

<span class="nc" id="L1084">            c.setAutoCommit(false);</span>
<span class="nc" id="L1085">            System.out.println(&quot;[searchVideoById]Opened database successfully&quot;);</span>

<span class="nc" id="L1087">            stmt = c.prepareStatement(query);</span>
<span class="nc" id="L1088">            stmt.setInt(1, id);</span>
<span class="nc" id="L1089">            ResultSet rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">            while (rs.next()) {</span>
<span class="nc" id="L1091">                video.setId(rs.getInt(&quot;id&quot;));</span>
<span class="nc" id="L1092">                video.setName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L1093">                video.setFormat(rs.getString(&quot;format&quot;));</span>
<span class="nc" id="L1094">                video.setFilePath(rs.getString(&quot;file_path&quot;));</span>
<span class="nc" id="L1095">                video.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="nc" id="L1097">            rs.close();</span>
<span class="nc" id="L1098">            stmt.close();</span>
<span class="nc" id="L1099">            c.close();</span>
<span class="nc" id="L1100">            return (video);</span>
<span class="nc" id="L1101">        } catch (SQLException e) {</span>
<span class="nc" id="L1102">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L1104">        System.out.println(&quot;[searchVideoById]Error&quot;);</span>
<span class="nc" id="L1105">        return (null);</span>
    }

    /**
     * Searches and returns a Audio object by its id, returns a Audio object
     * with id = 0 if not found.
     *
     * @param id Audio's id to search.
     * @return Audio
     */
    public Audio searchAudioById(int id) {
<span class="nc" id="L1116">        Connection c = this.connexion();</span>
<span class="nc" id="L1117">        PreparedStatement stmt = null;</span>
<span class="nc" id="L1118">        Audio audio = new Audio();</span>
<span class="nc" id="L1119">        String query = new String(&quot;SELECT * FROM Audio WHERE Audio.id=?;&quot;);</span>
        try {

<span class="nc" id="L1122">            c.setAutoCommit(false);</span>
<span class="nc" id="L1123">            System.out.println(&quot;[searchAudioById]Opened database successfully&quot;);</span>

<span class="nc" id="L1125">            stmt = c.prepareStatement(query);</span>
<span class="nc" id="L1126">            stmt.setInt(1, id);</span>
<span class="nc" id="L1127">            ResultSet rs = stmt.executeQuery();</span>
<span class="nc bnc" id="L1128" title="All 2 branches missed.">            while (rs.next()) {</span>
<span class="nc" id="L1129">                audio.setId(rs.getInt(&quot;id&quot;));</span>
<span class="nc" id="L1130">                audio.setName(rs.getString(&quot;name&quot;));</span>
<span class="nc" id="L1131">                audio.setFormat(rs.getString(&quot;format&quot;));</span>
<span class="nc" id="L1132">                audio.setFilePath(rs.getString(&quot;file_path&quot;));</span>
<span class="nc" id="L1133">                audio.setIdLanguage(rs.getInt(&quot;id_language&quot;));</span>
            }
<span class="nc" id="L1135">            rs.close();</span>
<span class="nc" id="L1136">            stmt.close();</span>
<span class="nc" id="L1137">            c.close();</span>
<span class="nc" id="L1138">            return (audio);</span>
<span class="nc" id="L1139">        } catch (SQLException e) {</span>
<span class="nc" id="L1140">            System.err.println(e.getClass().getName() + &quot;: &quot; + e.getMessage());</span>
        }
<span class="nc" id="L1142">        System.out.println(&quot;[searchAudioById]Error&quot;);</span>
<span class="nc" id="L1143">        return (null);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>